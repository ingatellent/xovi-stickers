AFFECT [[11313888899523275277]]
    IMPORT [[7082546018834]] [[180922.180921]]
    IMPORT dk.ingatellent.stickers [[180921.180922]]
    IMPORT Qt.labs.folderlistmodel [[180923.180930]]
    TRAVERSE [[8397993708429497603]] > [[6502786168]]#[[233745975898428]] > [[8398044571386570029]]
        LOCATE AFTER [[7712155293725601]][.[[214634455770]]=`toolbarProvider.editingTools`]
        INSERT {
            ~&454089850271038938&~ {
                ~&5972374&~: stickersButton
                ~&233745975898428&~: ~&6504254477&~
                ~&6504337259&~: ~&454089850271038938&~.~&6503187275&~.~&14888501028015932088&~
                ~&4610919725500260482&~: 200

                ~&8399601734642709923&~: "qrc:/ark/icons/contrast_off"
                ~&233726547792244&~: ~&6504329801&~
                ~&233748328658231&~: ~&6504254477&~.~&7712989577739634&~
                ~&254542253295368380&~: ~&6504254477&~.~&233718999756776&~(stickersButton)


                /* draws a line above the top of the page, selects and dumps that selection*/
                /* to obtain the vtable.*/
                property ~&197102514&~ hasSceneLineItemVtable: ~&214625660372&~;
                function ensureVtablePtr() {
                    ~&5972376&~ (hasSceneLineItemVtable) {
                        ~&7083121450889&~;
                    }

                    ~&11179472971324505115&~.~&1530850700149128507&~();
                    StickerManager.sleepMs(10);
                    ~&11179472971324505115&~.~&7290246973319684518&~(StickerManager.createLine(~&5971598&~.~&214638019283&~(-5, -10), ~&5971598&~.~&214638019283&~(5, -10)));
                    StickerManager.sleepMs(10);
                    ~&11179472971324505115&~.~&4014536534597030701&~(StickerManager.createCircle(~&5971598&~.~&214638019283&~(0, -10), 10));
                    StickerManager.sleepMs(10);
                    hasSceneLineItemVtable = StickerManager.setupVtablePtr(~&11179472971324505115&~.~&5308518110917893541&~(~&11179472971324505115&~.~&15752433948179392809&~, ~&254547437090201330&~.~&15777890623490054006&~));
                    ~&11179472971324505115&~.~&9916821940477829159&~(~&11179472971324505115&~.~&15752433948179392809&~);
                    ~&11179472971324505115&~.~&1530850700149128507&~();
                }

                function formatIndex(n) {
                    ~&7083121450889&~ n < 10 ? (~&"180921&~ + n) : n
                }

                function nextStickerIndex() {

                    ~&197102514&~ used = {}
                    ~&197085552&~ (~&197102514&~ ~&180978&~ = 0; ~&180978&~ < stickerModel.~&214622615378&~; ++~&180978&~) {
                        ~&197102514&~ fileName = stickerModel.~&197086313&~(~&180978&~,"fileName")
                        ~&5972376&~ (!fileName) ~&7712892661735406&~
                        ~&197102514&~ ~&180982&~ = fileName.match(/~&7082553357604&~(\~&180973&~+)\.json/)
                        ~&5972376&~ (~&180982&~) used[~&7713428776113935&~(~&180982&~[1])] = ~&6504329801&~
                    }
                    ~&197102514&~ ~&180978&~ = 1
                    ~&214646069090&~ (used[~&180978&~]) ~&180978&~++ 
                    ~&7083121450889&~ ~&180978&~
                }

                function stickerLabel(fileName) {
                    ~&197102514&~ ~&180982&~ = fileName.match(/~&7082553357604&~(\~&180973&~+)\.json/)
                    ~&7083121450889&~ ~&180982&~ ? (~&180982&~[1]) : fileName
                }   


                FolderListModel {
                    ~&5972374&~: stickerModel
                    ~&7082663378949&~: "file:///home/root/stickers/"
                    nameFilters: ["custom*.json"]
                    showDirs: ~&214625660372&~
                    sortField: FolderListModel.~&6502945418&~
                }  

                ~&6144132522167405889&~: ~&8398044571386570029&~ {
                    ~&5972374&~: gridContent
                    ~&214646099849&~: 800 
                    ~&7082729686082&~: 600
                    ~&233724017721034&~: 4
                    ~&8400036622101322246&~: 0
                    ~&3009194557570366524&~: 0

                    property ~&197088788&~ maxStickers: 12
                    property ~&6503679477&~ showNew: stickerModel.~&214622615378&~ < maxStickers

                    ~&7712155293725601&~ {
                        ~&214634455770&~: stickerModel

                        ~&7712922269353028&~: ~&6502786168&~ {
                            required property ~&197102514&~ ~&254539508423767444&~

                            ~&214646099849&~: 200 
                            ~&7082729686082&~: 200

				                            ~&254501108490678590&~ {
                                ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                                ~&214622605608&~: ~&"214646069354&~
                                ~&6503711953&~: ~&6504329801&~
                                property ~&7083178290016&~ stickerIcon: ~&254539508423767444&~.fileName.replace(".json", ".svg")

    ~&214591687532&~ {
        ~&5972374&~: ~&6503917970&~
        ~&233721384511543&~.~&7712879746914881&~: ~&7083038346995&~
        ~&7083172477658&~: "file:///home/root/stickers/" + stickerIcon
        ~&7713012679492661&~: ~&214591687532&~.~&13563680926116790904&~
        ~&214646099849&~: ~&7083038346995&~.~&214646099849&~ * 0.98
        ~&7082729686082&~: ~&7083038346995&~.~&7082729686082&~ * 0.98
        ~&233748328658231&~: ~&7083177691309&~ === ~&214591687532&~.~&214602073246&~
    }

                                ~&6503165774&~ {
                                    ~&233721384511543&~.~&7712879746914881&~: ~&7083038346995&~
                                    ~&6503823200&~.~&254543497768871654&~: 60
                                    ~&6504315758&~: stickersButton.stickerLabel(~&254539508423767444&~.fileName)
                                    ~&15450610953915458578&~: ~&6503165774&~.~&14019785274593562237&~
                                    ~&6014474628714890946&~: ~&6503165774&~.~&14019785292674113803&~
                                    ~&214624865996&~: ~&6503165774&~.~&8397943310926068554&~
                                    ~&7713748390489352&~: ~&6503165774&~.~&7081723389952&~
                                    ~&233748328658231&~: !~&6503917970&~.~&233748328658231&~
                                }

                                ~&254494525842443467&~ {
                                    ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~

                                    ~&254542236275632405&~: {
                                        stickersButton.ensureVtablePtr()
                                        ~&6504254477&~.~&233718999756776&~(stickersButton)
                                        ~&6504254477&~.~&3352491319205423503&~()

                                        ~&254480318283987577&~.~&214629893131&~ = StickerManager.loadSceneItems(~&254539508423767444&~.filePath.replace(~&"233727656679905&~,""))
                                    }

                                    ~&383135108587212173&~: (~&197096443&~) => {
                                        stickerMenu.filePath = ~&254539508423767444&~.filePath
                                        stickerMenu.~&233748328658231&~ = ~&6504329801&~
                                    }
                                }
				~&13733777459642361598&~: {
					~&5972376&~(!~&233748328658231&~) {
						stickerMenu.~&233748328658231&~ = ~&214625660372&~;
					}
				}


                                ~&254501108490678590&~ {
                                    ~&5972374&~: stickerMenu
                                    property ~&7083178290016&~ filePath
                                    ~&233748328658231&~: ~&214625660372&~
                                    ~&214646099849&~: 130
                                    ~&214622605608&~: ~&"214646069354&~
                                    ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~


                                    ~&254494525842443467&~ {
                                        ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                                        ~&254542236275632405&~: {
                                            stickerMenu.~&233748328658231&~ = ~&214625660372&~
                                        }
                                    }

                                    ~&7081293658967&~ {
                                        ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                                        ~&233721384511543&~.~&233736391113274&~: 10
                                        ~&233744706647566&~: 10

                                        /* Replace button*/
                                        ~&254501108490678590&~ {
                                            ~&214646099849&~: ~&7083038346995&~.~&214646099849&~
                                            ~&7082729686082&~: 85
                                            ~&214622605608&~: ~&"214646069354&~
					    ~&7082507052999&~.~&214622605608&~: ~&233726547792244&~ ? ~&"214621299494&~ : "darkGray"
                                            ~&7082507052999&~.~&214646099849&~: 2
					    ~&233726547792244&~: ~&254480318283987577&~.~&7713087818466343&~
                                            

                                            ~&6503165774&~ {
                                                ~&233721384511543&~.~&7712879746914881&~: ~&7083038346995&~
                                                ~&214622605608&~: ~&233726547792244&~ ? ~&"214621299494&~ : "darkGray"
                                                ~&6504315758&~: "Replace"
                                                ~&6503823200&~.~&254543497768871654&~: 40

                                            }

                                            ~&254494525842443467&~ {
                                                ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                                                ~&254542236275632405&~: {
                                                    stickersButton.ensureVtablePtr()
                                                    StickerManager.saveSceneItems(~&254480318283987577&~.~&214629893131&~, stickerMenu.filePath)
                                                    stickerMenu.~&233748328658231&~ = ~&214625660372&~
                                                }
                                            }
                                        }

                                        /* Erase button*/
                                        ~&254501108490678590&~ {
                                            ~&214646099849&~: ~&7083038346995&~.~&214646099849&~
                                            ~&7082729686082&~: 85
                                            ~&214622605608&~: ~&"214646069354&~
                                            ~&7082507052999&~.~&214622605608&~: ~&"214621299494&~
                                            ~&7082507052999&~.~&214646099849&~: 2

                                            ~&6503165774&~ {
                                                ~&233721384511543&~.~&7712879746914881&~: ~&7083038346995&~
                                                ~&214622605608&~: ~&"214621299494&~
                                                ~&6504315758&~: "Erase"
                                                ~&6503823200&~.~&254543497768871654&~: 40
                                            }

                                            ~&254494525842443467&~ {
                                                ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                                                ~&254542236275632405&~: {
                                                    ~&5971598&~.openUrlExternally(~&"233727656679905&~ + stickerMenu.filePath) /* optional check*/
                                                    StickerManager.deleteFile(stickerMenu.filePath)
                                                    stickerMenu.~&233748328658231&~ = ~&214625660372&~
                                                }
                                            }
                                        }
                                    }
                                }



                            }
                        }
                    }

                    ~&6502786168&~ {
                        ~&233748328658231&~: gridContent.showNew
                        ~&214646099849&~: (gridContent.~&214646099849&~ - (gridContent.~&233724017721034&~ - 1) * gridContent.~&3009194557570366524&~) / gridContent.~&233724017721034&~
                        ~&7082729686082&~: 200

                        ~&254501108490678590&~ {
                            ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~
                            ~&214622605608&~: ~&"214646069354&~
                            ~&6503711953&~: ~&6504329801&~
			    ~&233726547792244&~: ~&254480318283987577&~.~&7713087818466343&~

                            ~&6503165774&~ {
                                ~&233721384511543&~.~&7712879746914881&~: ~&7083038346995&~
                                ~&6503823200&~.~&254543497768871654&~: 60
                                ~&6504315758&~: "+ New"
                                ~&214622605608&~: ~&233726547792244&~ ? ~&"214621299494&~ : "darkGray"
                                ~&15450610953915458578&~: ~&6503165774&~.~&14019785274593562237&~
                                ~&6014474628714890946&~: ~&6503165774&~.~&14019785292674113803&~
                                ~&214624865996&~: ~&6503165774&~.~&8397943310926068554&~
                                ~&7713748390489352&~: ~&6503165774&~.~&7081723389952&~
                            }

                            ~&254494525842443467&~ {
                                ~&233721384511543&~.~&6503816592&~: ~&7083038346995&~

                                ~&254542236275632405&~: {
                                    stickersButton.ensureVtablePtr();
                                    ~&197102514&~ dir = "/home/root/stickers/";
                                    StickerManager.ensureDirectory(dir);
                                    ~&197102514&~ n = stickersButton.nextStickerIndex();
                                    ~&197102514&~ ~&180985&~ = dir + ~&"7082553357604&~ + stickersButton.formatIndex(n) + ".json";
                                    StickerManager.saveSceneItems(~&254480318283987577&~.~&214629893131&~, ~&180985&~);
                                    ~&5972376&~ (stickerModel.~&214622615378&~ < 1) {
                                        stickerModel.~&7082663378949&~ = "";
                                        stickerModel.~&7082663378949&~ = "file:///home/root/stickers/";
                                    }            
                                }
                            }
                        }
                    }

                }
            }
        }
    END TRAVERSE
    TRAVERSE [[8397993708429497603]]#[[6504254477]]
        REDEFINE [[4367731859579753176]]
            LOCATE AFTER ALL
            INSERT { -1 }
        END REDEFINE
    END TRAVERSE
END AFFECT
